function q = a2q(A)

    A1 = A(1,1);
    A2 = A(2,2);
    A3 = A(3,3);

    q = zeros(4,1);

    q(4) = sqrt(.25*(1+trace(A)));
    q(1) = sqrt(.25*(1+A1-A2-A3));
    q(2) = sqrt(.25*(1-A1+A2-A3));
    q(3) = sqrt(.25*(1-A1-A2+A3));

    qmax = max(q(q==real(q)));

    if qmax == q(1)
        q(1) = q(1);
        q(2) = (A(1,2)+A(2,1))/(4*q(1));
        q(3) = (A(3,1)+A(1,3))/(4*q(1));
        q(4) = (A(2,3)-A(3,2))/(4*q(1));

    elseif qmax == q(2)
        q(1) = (A(1,2)+A(2,1))/(4*q(2));
        q(2) = q(2);
        q(3) = (A(2,3)+A(3,2))/(4*q(2));
        q(4) = (A(3,1)-A(1,3))/(4*q(2));

    elseif qmax == q(3)
        q(1) = (A(3,1)+A(1,3))/(4*q(3));
        q(2) = (A(2,3)+A(3,2))/(4*q(3));
        q(3) = q(3);
        q(4) = (A(1,2)-A(2,1))/(4*q(3));

    elseif qmax == q(4)
        q(1) = (A(2,3)-A(3,2))/(4*q(4));
        q(2) = (A(3,1)-A(1,3))/(4*q(4));
        q(3) = (A(1,2)-A(2,1))/(4*q(4));
        q(4) = q(4);

    end

    q = q/norm(q);
end